@using Umbraco.Cms.Web.Common.PublishedModels
@using TheSiliconPost.Models
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    Layout = "_Layout.cshtml";
    
    var tag = new Tag(Model, null);
    ViewBag.Title = $"Tag: {tag.Name}";
    ViewBag.MetaDescription = $"Articles tagged with {tag.Name}";
    
    // Get all blog posts with this tag
    var blogPosts = Model.Root()
        .DescendantsOrSelfOfType("blogPost")
        .Where(x => x.Value<IEnumerable<IPublishedContent>>("tags")?.Any(t => t.Id == Model.Id) ?? false)
        .OrderByDescending(x => x.Value<DateTime>("publishDate"))
        .Select(x => new BlogPost(x, null))
        .ToList();
}

<div class="tag-page">
    <header class="page-header">
        <h1>Tag: @tag.Name</h1>
        <p class="post-count">@blogPosts.Count @(blogPosts.Count == 1 ? "article" : "articles")</p>
    </header>
    
    @if (blogPosts.Any())
    {
        <div class="posts-list">
            @foreach (var post in blogPosts)
            {
                <article class="post-item">
                    @if (post.FeaturedImage != null)
                    {
                        <a href="@post.Url" class="post-image">
                            <img src="@post.FeaturedImage.Url()" alt="@post.Title" />
                        </a>
                    }
                    
                    <div class="post-info">
                        <h2><a href="@post.Url">@post.Title</a></h2>
                        
                        <div class="post-meta">
                            <time datetime="@post.PublishDate.ToString("yyyy-MM-dd")">
                                @post.PublishDate.ToString("MMMM dd, yyyy")
                            </time>
                            @if (post.Author != null)
                            {
                                <span>by @post.Author.Name</span>
                            }
                        </div>
                        
                        @if (!string.IsNullOrEmpty(post.Excerpt))
                        {
                            <p>@post.Excerpt</p>
                        }
                        
                        @if (post.Categories.Any())
                        {
                            <div class="post-categories">
                                @foreach (var category in post.Categories)
                                {
                                    <a href="@category.Url" class="category-badge">@category.Name</a>
                                }
                            </div>
                        }
                        
                        <a href="@post.Url" class="read-more">Read More â†’</a>
                    </div>
                </article>
            }
        </div>
    }
    else
    {
        <p>No articles found with this tag yet.</p>
    }
</div>
